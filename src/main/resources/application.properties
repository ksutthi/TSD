# ============================================================
# ? 1. PRIMARY DATABASE: TSD Registry (Persistent)
# ============================================================
spring.datasource.url=jdbc:sqlserver://localhost:1433;databaseName=TSD_Registry;encrypt=false
spring.datasource.username=sa
spring.datasource.password=NewPassword123!
spring.datasource.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver

# ============================================================
# ? 2. SECONDARY DATABASE: SET OneID (Mock Identity)
# ============================================================
spring.datasource.oneid.url=jdbc:sqlserver://localhost:1433;databaseName=SET_One_ID;encrypt=false
spring.datasource.oneid.username=sa
spring.datasource.oneid.password=NewPassword123!
spring.datasource.oneid.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver

# ============================================================
# ? 3. HIBERNATE / JPA (The Persistence Logic)
# ============================================================
spring.jpa.database-platform=org.hibernate.dialect.SQLServerDialect
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy

# ?? CRITICAL FOR PERSISTENCE:
# 'update' = Keep data, update schema.
# 'create' or 'create-drop' = WIPE DATA on startup (Do not use!)
spring.jpa.hibernate.ddl-auto=update

# ? DEBUGGING: Show the SQL in the logs so we know it's saving!
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
logging.level.org.hibernate.SQL=DEBUG
# logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ============================================================
# ? 4. SPRING BATCH (Stop automatic wipes)
# ============================================================
# 'never' = Assume tables exist. Don't run init scripts that might drop/reset data.
spring.batch.jdbc.initialize-schema=never
spring.batch.job.enabled=false
spring.main.allow-bean-definition-overriding=true

# ============================================================
# ? 5. LOGGING
# ============================================================
logging.level.org.jooq.Constants=WARN

# ? Show the values that replace the '?'

# ? 2. Show the VALUES inside the (?, ?) (This is what you are missing)
# logging.level.org.hibernate.orm.jdbc.bind=TRACE

# ==========================================================================================
# ?? RESILIENCE4J CONFIGURATION (Circuit Breaker)
# ==========================================================================================
# Rule: If 50% of the last 10 calls fail, OPEN the circuit (Stop calling).
resilience4j.circuitbreaker.instances.identity-service.sliding-window-size=10
resilience4j.circuitbreaker.instances.identity-service.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.identity-service.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.identity-service.permitted-number-of-calls-in-half-open-state=3