### ==========================================
### TEST 1: IDEMPOTENCY (The Double-Click Test)
### ==========================================

### 1A. Fire the first request (This will hang for 2 seconds)
POST http://localhost:8081/api/v1/test/idempotency
X-Idempotency-Key: my-secure-uuid-001

### 1B. FIRE THIS IMMEDIATELY AFTER 1A (While 1A is still running)
POST http://localhost:8081/api/v1/test/idempotency
X-Idempotency-Key: my-secure-uuid-001

# EXPECTED EVIDENCE for 1B: HTTP 409 Conflict.
# "Duplicate Request. Transaction is currently IN_PROGRESS"


### ==========================================
### TEST 2: MAKER-CHECKER (The Vault Lock Test)
### ==========================================

### ==========================================
### TEST 2: MAKER-CHECKER (The Vault Lock Test)
### ==========================================

### 2A. Initialize the Job (Look at the response to get your Job ID)
POST http://localhost:8081/api/v1/test/maker-checker/init
X-Idempotency-Key: init-job-002

### 2B. Approve the Job (Admin 99)
POST http://localhost:8081/api/v1/test/maker-checker/approve/TEST-JOB-9d146?checkerId=ADMIN_CHECKER_99
X-Idempotency-Key: approve/FAKE-JOB-123

### 2C. RACE CONDITION TEST (Admin 88)
POST http://localhost:8081/api/v1/test/maker-checker/approve/TEST-JOB-9d146?checkerId=ADMIN_CHECKER_88
X-Idempotency-Key: approve-job-admin-88

### ==========================================
### TEST 3: CIRCUIT BREAKER (The Outage Test)
### ==========================================

### 3A. Simulate Bank Outage (Click this 5 times rapidly)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=true

# EXPECTED EVIDENCE for 3A: The first 5 will take time and return 500 Errors.

### 3B. Check if the Circuit is OPEN (Click this after the 5 failures)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false

# EXPECTED EVIDENCE for 3B: Even though fail is FALSE, the system refuses to hit the bank.
# It instantly returns "Result: QUEUED_FOR_RETRY". The blast doors are closed.

### TEST 4: The Trace ID JSON Test
GET http://localhost:8081/api/v1/test/crash




### ===================================================================
### TSD REGISTRY PLATFORM - LOCAL MOCK IDENTITY TESTS
### ===================================================================

### 1. Test as HEAD OF OPERATIONS (High Approval Limit)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: ops-admin-01
X-Mock-FullName: Sarah Jenkins
X-Mock-Role: HEAD_OF_OPERATIONS
X-Mock-Broker: TSD_INTERNAL
X-Mock-Limit: 55000000.00
Accept: application/json

###

### 2. Test as BROKER MAKER (Initiates Transfers)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: broker-maker-99
X-Mock-FullName: Somchai Trader
X-Mock-Role: MAKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 5000000.00
Accept: application/json

###

### 3. Test as BROKER CHECKER (Approves Transfers)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: broker-checker-42
X-Mock-FullName: Naree Approver
X-Mock-Role: CHECKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 10000000.00
Accept: application/json

###

### 4. Test as EXTERNAL SYSTEM (Batch Processor)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: sys-batch-eod
X-Mock-FullName: EOD Batch Processor
X-Mock-Role: SYSTEM
X-Mock-Broker: SYSTEM
X-Mock-Limit: 999999999.00
Accept: application/json




### ===================================================================
### TSD REGISTRY PLATFORM - LOCAL MOCK IDENTITY TESTS
### ===================================================================

### 1. Test as TSD HEAD OF OPERATIONS (High Approval Limit)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: ops-admin-01
X-Mock-FullName: Sarah Jenkins
X-Mock-Role: HEAD_OF_OPERATIONS
X-Mock-Broker: TSD_INTERNAL
X-Mock-Limit: 55000000.00
Accept: application/json

###

### 2. Test as BROKER MAKER (Initiates Transfers)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: broker-maker-99
X-Mock-FullName: Somchai Trader
X-Mock-Role: MAKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 5000000.00
Accept: application/json

###

### 3. Test as BROKER CHECKER (Approves Transfers)
GET http://localhost:8081/api/v1/test/circuit-breaker?fail=false
X-Mock-User: broker-checker-42
X-Mock-FullName: Naree Approver
X-Mock-Role: CHECKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 10000000.00
Accept: application/json




### ===================================================================
### TSD REGISTRY PLATFORM - POLICY ENGINE TESTS
### ===================================================================

### 1. Test Maker UNDER limit (Should Succeed)
GET http://localhost:8081/api/v1/test/policy/transfer?amount=4000000
X-Mock-User: broker-maker-99
X-Mock-FullName: Somchai Trader
X-Mock-Role: MAKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 5000000.00
Accept: application/json

###

### 2. Test Maker OVER limit (Should Fail - 403 Forbidden)
GET http://localhost:8081/api/v1/test/policy/transfer?amount=8000000
X-Mock-User: broker-maker-99
X-Mock-FullName: Somchai Trader
X-Mock-Role: MAKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 5000000.00
Accept: application/json


### ===================================================================
### TSD REGISTRY PLATFORM - END-TO-END MAKER/CHECKER TEST
### ===================================================================

### 1. Checker Approves the Job (Using Secure Context)
POST http://localhost:8081/api/v1/workflows/JOB-1771823394109/approve
X-Mock-User: broker-checker-42
X-Mock-FullName: Naree Approver
X-Mock-Role: CHECKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 10000000.00
Accept: application/json

###

### 2. Unauthorized Approval Attempt (Should Fail - 403 Forbidden)
POST http://localhost:8081/api/v1/workflows/JOB-1771823394109/approve
X-Mock-User: broker-maker-99
X-Mock-FullName: Somchai Trader
X-Mock-Role: MAKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 5000000.00
Accept: application/json




### Create a Dummy Job (With Idempotency Key)
POST http://localhost:8081/api/v1/test/maker-checker/init
X-Idempotency-Key: init-job-12345


### Approve the Job as a CHECKER (With Mock Security & Idempotency)
POST http://localhost:8081/api/v1/test/maker-checker/approve/TEST-JOB-98b7e
X-Idempotency-Key: approve-job-98b7e
X-Mock-User: broker-checker-42
X-Mock-FullName: Naree Approver
X-Mock-Role: CHECKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 10000000.00
Accept: application/json



### ===================================================================
### THE FINAL TEST: APPROVAL + ENGINE WAKE-UP
### ===================================================================

### 1. Create a Dummy Job
POST http://localhost:8081/api/v1/test/maker-checker/init
X-Idempotency-Key: init-job-wakeup-test-2


### 2. Approve the Job (Should trigger ‚è∞ Engine-Wakeup)
POST http://localhost:8081/api/v1/test/maker-checker/approve/TEST-JOB-67296
X-Idempotency-Key: approve-job-wakeup-test-2
X-Mock-User: broker-checker-42
X-Mock-FullName: Naree Approver
X-Mock-Role: CHECKER
X-Mock-Broker: KGI_001
X-Mock-Limit: 10000000.00
Accept: application/json



### ===================================================================
### TRACE ID COROUTINE TEST
### ===================================================================

POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Trace-Id: TRACE-JUMP-9999
X-Idempotency-Key: trace-test-003

{
  "transactionId": "TXN-TRACE-003",
  "workflowId": "TSD-01",
  "registrar": "TSD",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "paymentMode": "Standard"
}


### ===================================================================
### TRIGGER UNIVERSAL BATCH (30 Records)
### ===================================================================
POST http://localhost:8081/api/v1/workflows/batch/TSD/TSD-01?records=30
Content-Type: application/json
X-Trace-Id: BATCH-TRACE-999
X-Idempotency-Key: batch-run-001



### ===================================================================
### FIRE-AND-FORGET ASYNC BATCH TEST (30 Records)
### ===================================================================
POST http://localhost:8081/api/v1/workflows/batch/TSD/TSD-01?records=30
Content-Type: application/json
X-Trace-Id: ASYNC-BATCH-9000
X-Idempotency-Key: batch-async-run-002




### 1. SINGLE EXECUTION - HAPPY PATH (SWIFT PAYMENT)
POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Trace-Id: TRACE-HAPPY-005
X-Idempotency-Key: idemp-happy-005

{
  "registrar": "TSD",
  "workflowId": "TSD-01",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "Payment_Mode": "SWIFT"
}



### 1. SINGLE EXECUTION - HAPPY PATH (SWIFT PAYMENT)
POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Trace-Id: TRACE-HAPPY-007
X-Idempotency-Key: idemp-happy-007

{
  "registrar": "TSD",
  "workflowId": "TSD-01",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "Payment_Mode": "SWIFT"
}






### ===================================================================
### üå©Ô∏è CHAOS ENGINEERING (FAULT TOLERANCE TESTS)
### ===================================================================

### 1. TURN ON CHAOS MONKEY (Break the External Network)
# Forces the MockExternalController to return 500 Internal Server Errors
POST http://localhost:8081/api/mock-external/chaos?down=true


### 2. SINGLE EXECUTION - NETWORK FAILURE & SAGA ROLLBACK
# Run this AFTER turning on Chaos Monkey.
# Watch the console for the HTTP retries, the Circuit Breaker Fallback,
# and the SAGA Compensation rollback kicking in!
POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Trace-Id: TRACE-CHAOS-001
X-Idempotency-Key: idemp-chaos-001

{
  "registrar": "TSD",
  "workflowId": "TSD-01",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "Payment_Mode": "SWIFT"
}


### 3. TURN OFF CHAOS MONKEY (Restore the Network)
# Restores the MockExternalController to return 200 OK so you can run normal tests again
POST http://localhost:8081/api/mock-external/chaos?down=false

### 3. ASYNCHRONOUS UNIVERSAL BATCH EXECUTION (30 Records)
POST http://localhost:8081/api/v1/workflows/batch/TSD/TSD-01?records=30
Content-Type: application/json
X-Trace-Id: ASYNC-BATCH-002
X-Idempotency-Key: batch-run-002


### 3. ASYNCHRONOUS UNIVERSAL BATCH EXECUTION (30 Records)
POST http://localhost:8081/api/v1/workflows/batch/TSD/TSD-01?records=30
Content-Type: application/json
X-Trace-Id: ASYNC-BATCH-004
X-Idempotency-Key: batch-run-004

### 3. ASYNCHRONOUS UNIVERSAL BATCH EXECUTION (30 Records)
POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Idempotency-Key: start-new-job-001

{
  "workflowId": "TSD-01",
  "registrar": "TSD",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "paymentMode": "Standard"
}

### 3. ASYNCHRONOUS UNIVERSAL BATCH EXECUTION (30 Records)
POST http://localhost:8081/api/v1/workflows/API-25997f3e/approve
Content-Type: application/json
X-Idempotency-Key: checker-approve-25997f3e




### 1. The Maker (Trigger the Workflow)
# Run this first. Look at the console or the response JSON to get the generated JOB-XXX ID.
POST http://localhost:8081/api/v1/workflows/execute
Content-Type: application/json
X-Idempotency-Key: matrix-maker-test-004

{
  "workflowId": "TSD-01",
  "registrar": "TSD",
  "amount": 50000.00,
  "currency": "THB",
  "investorId": "ACCT-001",
  "walletId": "W-998877",
  "targetBank": "BBL_TH",
  "paymentMode": "Standard"
}

### 2. The Checker (Wake up the Engine) - THE GOLDEN TICKET
# Don't forget to replace the ID with a fresh one from the Maker!
POST http://localhost:8081/api/v1/workflows/API-c24250b8/approve
Content-Type: application/json
X-Idempotency-Key: matrix-checker-test-004
X-Mock-User: admin_checker
X-Mock-Role: CHECKER
X-Mock-Limit: 99999999